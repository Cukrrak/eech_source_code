/*
 * laser.c
 *
 *  Created on: 3. mars 2010
 *      Author: arneh
 */

#include "project.h"

#include "laser.h"

// One slot for each valid frequency.  Each slot contains a list of all designations for that frequency
laser_designation* laser_designations[512];

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/* The display frequencies have the following format:
 * ABCC where A always is 1, B is 1-7 and C is 1-8.
 * Pack this as three octal numbers (BCC)
 */

unsigned get_packed_laser_frequency(const char* display_freq)
{
	unsigned digit, shift, i;
	unsigned packed = 0;

	ASSERT(strlen(display_freq) == 4);
	ASSERT(display_freq[0] == '1');

	for (i=3, shift=0; i > 0; i--, shift+=3)
	{
		digit = display_freq[i] - '1';
		packed += digit << shift;
	}

	return packed;
}

void get_display_laser_frequency(unsigned packed_freq, char* display_freq)
{
	unsigned shift, i;

	for (i=3, shift=0; i > 0; i--, shift+=3)
	{
		display_freq[i] = (packed_freq & 7) + '1';
		packed_freq >>= 3;
	}

	display_freq[0] = '1';
	display_freq[4] = 0;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
